(function(t){function e(e){for(var a,s,o=e[0],u=e[1],c=e[2],d=0,h=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&h.push(n[s][0]),n[s]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(t[a]=u[a]);l&&l(e);while(h.length)h.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],a=!0,o=1;o<i.length;o++){var u=i[o];0!==n[u]&&(a=!1)}a&&(r.splice(e--,1),t=s(s.s=i[0]))}return t}var a={},n={app:0},r=[];function s(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=a,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var l=u;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},cd49:function(t,e,i){"use strict";i.r(e);var a=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("router-view")],1)},r=[],s=a["a"].extend({name:"App"}),o=s,u=i("2877"),c=Object(u["a"])(o,n,r,!1,null,null,null),l=c.exports,d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"editor"}},[i("editor-controller",{attrs:{"selected-key":t.selectedKey,"load-score-data-str":t.loadScoreDataStr,"load-music-url":t.loadMusicUrl}})],1)},h=[],f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"editor-controller"}},[i("editor-main",{attrs:{"page-num":t.pageNum,"load-score-data":t.scoreData,"selected-key":t.keyKind},on:{"page-minus":t.pageMinus,"page-plus":t.pagePlus}}),i("div",{attrs:{id:"editor-menu"}},[i("div",{staticClass:"menu-item-container",attrs:{id:"menu-page"}},[i("div",{staticClass:"menu-txt"},[t._v("Page")]),i("div",{staticClass:"menu-move-display"},[i("div",{staticClass:"menu-move-btn",on:{click:function(e){return t.pageMinus(5)}}},[t._v("◁")]),i("div",{staticClass:"menu-move-btn",on:{click:function(e){return t.pageMinus(1)}}},[t._v("◁")]),i("div",{staticClass:"menu-move-txt"},[t._v(t._s(t.pageNum))]),i("div",{staticClass:"menu-move-btn",on:{click:function(e){return t.pagePlus(1)}}},[t._v("▷")]),i("div",{staticClass:"menu-move-btn",on:{click:function(e){return t.pagePlus(5)}}},[t._v("▷")])])]),i("div",{staticClass:"menu-item-container",attrs:{id:"menu-label"}},[i("div",{attrs:{id:"menu-move-header"}},[i("div",{staticClass:"menu-txt"},[t._v("Label")]),i("input",{ref:"label-checkbox",staticClass:"uk-checkbox",attrs:{id:"menu-label-checkbox",type:"checkbox",disabled:1===t.pageNum},domProps:{checked:-1!==t.getLabelNumByPageNum(t.pageNum)},on:{click:t.callLabelOperation}})]),i("div",{staticClass:"menu-move-display"},[i("div",{staticClass:"menu-move-btn",on:{click:function(e){return t.labelMinus(5)}}},[t._v("◁")]),i("div",{staticClass:"menu-move-btn",on:{click:function(e){return t.labelMinus(1)}}},[t._v("◁")]),i("div",{staticClass:"menu-move-txt"},[t._v(t._s(t.labelNum))]),i("div",{staticClass:"menu-move-btn",on:{click:function(e){return t.labelPlus(1)}}},[t._v("▷")]),i("div",{staticClass:"menu-move-btn",on:{click:function(e){return t.labelPlus(5)}}},[t._v("▷")])])]),i("div",{staticClass:"menu-item-container",attrs:{id:"menu-fn"}},[i("div",{staticClass:"menu-txt"},[t._v("First Number")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.timing.firstNum,expression:"timing.firstNum"}],staticClass:"uk-input uk-form-small",attrs:{type:"number"},domProps:{value:t.timing.firstNum},on:{input:function(e){e.target.composing||t.$set(t.timing,"firstNum",e.target.value)}}})]),i("div",{staticClass:"menu-item-container",attrs:{id:"menu-bpm"}},[i("div",{staticClass:"menu-txt"},[t._v("BPM")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.timing.bpm,expression:"timing.bpm"}],staticClass:"uk-input uk-form-small",attrs:{type:"number"},domProps:{value:t.timing.bpm},on:{input:function(e){e.target.composing||t.$set(t.timing,"bpm",e.target.value)}}})]),i("div",{staticClass:"menu-item-container",attrs:{id:"menu-output"}},[i("div",{staticClass:"menu-output-btn btn-red",on:{click:t.convert}},[t._v("GO")]),i("div",{staticClass:"menu-output-btn btn-blue",on:{click:t.save}},[t._v("SAVE")])])])],1)},m=[],p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"canvas",attrs:{id:"canvas",tabindex:"-1"},on:{keydown:function(e){return e.preventDefault(),t.keydownAction(e)}}})},v=[],g=i("362d"),y=i.n(g),b={5:{num:5,keys:["KeyJ","KeyK","KeyI","KeyL","KeyF"],noteNames:["left_data","down_data","up_data","right_data","space_data"],freezeNames:["frzLeft_data","frzDown_data","frzUp_data","frzRight_data","frzSpace_data"]},7:{num:7,keys:["KeyS","KeyD","KeyF","KeyG","KeyJ","KeyK","KeyL"],noteNames:["left_data","leftdia_data","down_data","space_data","up_data","rightdia_data","right_data"],freezeNames:["frzLeft_data","frzLeftdia_data","frzDown_data","frzSpace_data","frzUp_data","frzRightdia_data","frzRight_data"]},11:{num:11,keys:["KeyS","KeyD","KeyF","KeyG","KeyJ","KeyK","KeyL","KeyU","KeyI","Digit8","KeyO"],noteNames:["left_data","leftdia_data","down_data","space_data","up_data","rightdia_data","right_data","sleft_data","sdown_data","sup_data","sright_data"],freezeNames:["frzLeft_data","frzLeftdia_data","frzDown_data","frzSpace_data","frzUp_data","frzRightdia_data","frzRight_data","sfrzLeft_data","sfrzDown_data","sfrzUp_data","sfrzRight_data"]}},k=30,_=5,N=384,D=N,w=N/8,P=60,S=20,K=a["a"].extend({name:"EditorMain",props:{pageNum:Number,selectedKey:String,loadScoreData:{type:Object}},data:function(){var t=this.selectedKey;return{currentPosition:0,scoreData:this.loadScoreData,divisor:24,keyKind:t,page:1,keyNum:b[t].num,editorWidth:k*b[t].num}},methods:{baseLayerDraw:function(){var t=this.divisor,e=this.keyNum,i=this.editorWidth,a=this.stage,n=this.baseLayer,r=this.notesLayer,s=this.currentPositionLayer;n.destroyChildren();for(var o=0;o<e;o++){var u=(o+1)*k,c=new y.a.Line({points:[u,0,u,D],stroke:"#969696",strokeWidth:.5});if(n.add(c),o%2==1){var l=new y.a.Rect({x:u-k,width:k,height:D,fill:"#c3f3ff",strokeWidth:0});n.add(l)}}for(o=0;o<N/t;o++){var d=(o+1)*t;c=new y.a.Line({points:[0,d,i,d],stroke:"#969696",strokeWidth:t*(o+1)%w==0?1:.5});n.add(c)}var h=new y.a.Rect({width:i,height:D,stroke:"black",strokeWidth:1});n.add(h),a.add(n),a.add(r),a.add(s)},currentPositionDraw:function(){var t=this.stage,e=this.currentPositionLayer;e.destroyChildren();var i=new y.a.Line({y:D-this.currentPosition,points:[0,0,this.editorWidth,0],stroke:"#ffff00",strokeWidth:1.5});e.add(i),t.add(e)},hasNote:function(t,e,i){var a=this.scoreData.scores[this.page-1];return a.notes[e].includes(i)||a.freezes[e].includes(i)},noteAdd:function(t,e,i,a){a?this.scoreData.scores[t-1].freezes[e].push(i):this.scoreData.scores[t-1].notes[e].push(i)},noteRemove:function(t,e,i){this.scoreData.scores[t-1].freezes[e]=this.scoreData.scores[t-1].freezes[e].filter((function(t){return t!==i})),this.scoreData.scores[t-1].notes[e]=this.scoreData.scores[t-1].notes[e].filter((function(t){return t!==i}))},noteDraw:function(t,e,i){var a=this.stage,n=this.notesLayer,r=function(t,e){return e?t%2==0?"#ff4dd2":"#00ffff":t%2==0?"red":"blue"}(t,i),s=new y.a.Rect({x:t*k,y:D-e-_/2,width:k,height:_,fill:r,id:"note-"+t+"-"+e});n.add(s),a.add(n)},noteClear:function(t,e){var i=this.stage,a=this.notesLayer,n=a.findOne("#note-"+t+"-"+e);n.destroy(),i.add(a)},displayPageScore:function(t){var e=this,i=this.stage,a=this.notesLayer,n=this.scoreData.scores[t-1];a.destroyChildren(),i.add(a),n.notes.forEach((function(t,i){t.forEach((function(t){e.noteDraw(i,t,!1)}))})),n.freezes.forEach((function(t,i){t.forEach((function(t){e.noteDraw(i,t,!0)}))}))},currentPositionMove:function(t){this.currentPosition=t,this.currentPositionDraw()},pageMove:function(t){this.page=t,this.currentPositionMove(0);var e=this.scoreData.scores[t-1];void 0===e&&(this.scoreData.scores[t-1]={notes:new Array(this.keyNum).fill([]).map((function(){return[]})),freezes:new Array(this.keyNum).fill([]).map((function(){return[]}))}),this.displayPageScore(t)},pageMinus:function(t){this.$emit("page-minus",t),Math.max(1,this.page-t),this.pageMove(this.page)},pagePlus:function(t){this.$emit("page-plus",t),this.page+=t,this.pageMove(this.page)},changeDivisor:function(t){this.divisor=t,this.currentPosition%t!==0&&this.currentPositionMove(Math.floor(this.currentPosition/t)*t),this.baseLayerDraw()},keydownAction:function(t){if(t.ctrlKey)switch(t.code){case"Digit1":this.changeDivisor(w);break;case"Digit2":this.changeDivisor(w/2);break;case"Digit3":this.changeDivisor(w/4);break;case"Digit4":this.changeDivisor(w/3);break;case"Digit5":this.changeDivisor(w/6);break;case"Digit6":this.changeDivisor(w/12);break;case"Digit7":this.changeDivisor(w/8);break}else switch(t.code){case"Space":this.currentPosition+=this.divisor,this.currentPosition>=N?this.pagePlus(1):this.currentPositionMove(this.currentPosition);break;case"ArrowUp":this.currentPosition+=this.divisor,this.currentPosition>=N?this.pagePlus(1):this.currentPositionMove(this.currentPosition);break;case"ArrowDown":this.currentPosition-=this.divisor,this.currentPosition<0?1===this.page?this.currentPosition=0:this.pageMinus(1):this.currentPositionMove(this.currentPosition);break;case"ArrowLeft":t.shiftKey?this.pageMinus(5):this.pageMinus(1);break;case"ArrowRight":t.shiftKey?this.pagePlus(5):this.pagePlus(1);break;default:var e=b[this.keyKind].keys.indexOf(t.code),i=t.shiftKey;e>=0&&(this.hasNote(this.page,e,this.currentPosition)?(this.noteRemove(this.page,e,this.currentPosition),this.noteClear(e,this.currentPosition)):(this.noteAdd(this.page,e,this.currentPosition,i),this.noteDraw(e,this.currentPosition,i)),this.currentPosition+=this.divisor,this.currentPosition>=N?this.pagePlus(1):this.currentPositionMove(this.currentPosition));break}}},mounted:function(){var t=new y.a.Stage({x:S,y:S,container:"canvas",width:this.editorWidth+2*S,height:D+2*S}),e=new y.a.Layer({container:"baseLayer"}),i=new y.a.Layer({container:"currentPositionLayer"}),a=new y.a.Layer({container:"notesLayer"});this.stage=t,this.baseLayer=e,this.currentPositionLayer=i,this.notesLayer=a,this.baseLayerDraw(),this.currentPositionDraw(),this.displayPageScore(1)},watch:{pageNum:function(t){this.pageMove(t)},scoreData:function(t){this.$emit("changeScoreData",t)}}}),x=K,M=Object(u["a"])(x,p,v,!1,null,null,null),C=M.exports,L=function(){function t(t){this.keyNum=t,this.timings=[{label:1,firstNum:200,bpm:140}],this.scores=[{notes:new Array(this.keyNum).fill([]).map((function(){return[]})),freezes:new Array(this.keyNum).fill([]).map((function(){return[]}))}]}return t}(),z=function(){function t(t,e){this.keyKind=t,this.keyConfig=e,this.keyNum=this.keyConfig[this.keyKind].num}return t.prototype.toFrameData=function(t){for(var e={notes:new Array(this.keyNum).fill([]).map((function(){return[]})),freezes:new Array(this.keyNum).fill([]).map((function(){return[]}))},i=t.timings.sort((function(t,e){return t.label-e.label})),a=t.scores,n=0,r=a.length+1,s=[],o=function(t){var r=a[t-1];if(void 0===r)s.push(e);else{i[n]&&t===i[n].label&&n++;var o=i[n-1],u=60*P/w/o.bpm,c=o.firstNum+(t-o.label)*N*u,l=r.notes.map((function(t){return t.map((function(t){return Math.round(c+t*u)}))})),d=r.freezes.map((function(t){return t.map((function(t){return Math.round(c+t*u)}))}));s.push({notes:l,freezes:d})}},u=1;u<r;u++)o(u);return s},t.prototype.convert=function(t){var e=this,i=this.toFrameData(t),a={notes:new Array(this.keyNum).fill([]).map((function(){return[]})),freezes:new Array(this.keyNum).fill([]).map((function(){return[]}))},n=i.reduce((function(t,i){for(var a=0;a<e.keyNum;a++)t.notes[a]=t.notes[a].concat(i.notes[a]),t.freezes[a]=t.freezes[a].concat(i.freezes[a]);return t}),a),r=n.notes.reduce((function(t,i,a){return t+e.keyConfig[e.keyKind].noteNames[a]+"="+i.join(",")+"|"}),"|"),s=n.freezes.reduce((function(t,i,a){return t+e.keyConfig[e.keyKind].freezeNames[a]+"="+i.join(",")+"|"}),r);return s},t.prototype.save=function(t){return JSON.stringify(t)},t}(),O=a["a"].extend({name:"EditorController",components:{EditorMain:C},props:{selectedKey:String,loadScoreDataStr:String,loadMusicUrl:String},data:function(){var t,e=this.selectedKey,i=b[e].num;try{t=this.loadScoreDataStr?JSON.parse(this.loadScoreDataStr):new L(i)}catch(a){alert("不正な譜面データが与えられたため、正しく読み込めませんでした。"),t=new L(i)}return{pageNum:1,labelNum:1,timing:{label:1,firstNum:200,bpm:140},scoreData:t,keyKind:this.selectedKey,keyConfig:b}},methods:{pageMinus:function(t){this.pageNum=Math.max(1,this.pageNum-t)},pagePlus:function(t){this.pageNum+=t},labelMinus:function(t){this.labelNum=Math.max(1,this.labelNum-t),this.labelMove(this.labelNum),this.pageNum=this.scoreData.timings[this.labelNum-1].label},labelPlus:function(t){this.labelNum=Math.min(this.scoreData.timings.length,this.labelNum+t),this.labelMove(this.labelNum),this.pageNum=this.scoreData.timings[this.labelNum-1].label},labelMove:function(t){var e=this.scoreData.timings[t-1];this.labelNum=t,this.timing=e},changeScoreData:function(t){this.scoreData=t},convert:function(){var t=new z(this.keyKind,this.keyConfig),e=t.convert(this.scoreData);navigator.clipboard&&(navigator.clipboard.writeText(e),alert("セーブデータをクリップボードにコピーしました！"))},save:function(){var t=new z(this.keyKind,this.keyConfig),e=t.save(this.scoreData);navigator.clipboard&&(navigator.clipboard.writeText(e),alert("セーブデータをクリップボードにコピーしました！"))},getLabelNumByPageNum:function(t){var e=this.scoreData.timings.map((function(t){return t.label}));return e.indexOf(t)},getNearestLabelNumByPageNum:function(t){var e=this.scoreData.timings.map((function(t){return t.label})),i=e.reduce((function(e,i){return i<=t?e+1:e}),0);return i},labelOperation:function(t,e){if(e){var i=this.getLabelNumByPageNum(t);this.scoreData.timings.splice(i,1),this.labelNum--,this.timing=this.scoreData.timings[this.labelNum-1]}else{var a=this.timing,n=60*P/w/a.bpm,r=a.firstNum+(t-a.label)*N*n,s={label:t,firstNum:r,bpm:a.bpm};this.scoreData.timings.splice(this.labelNum,0,s),this.timing=s,this.labelNum++}},callLabelOperation:function(){var t=this.pageNum,e=-1!==this.getLabelNumByPageNum(t);this.labelOperation(t,e),this.pageNum=t}},watch:{pageNum:function(t){var e=this.getNearestLabelNumByPageNum(t);this.labelNum=e,this.labelMove(e)}}}),R=O,A=Object(u["a"])(R,f,m,!1,null,null,null),E=A.exports,j=a["a"].extend({name:"Editor",components:{EditorController:E},props:{loadScoreDataStr:String,loadMusicUrl:String,selectedKey:String}}),T=j,U=Object(u["a"])(T,d,h,!1,null,null,null),F=U.exports,$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"start"}},[i("start-main")],1)},W=[],B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"start-container"}},[i("div",{attrs:{id:"start-title"}},[t._v("Dancing☆Onigiri Editor")]),i("div",{attrs:{id:"start-menu"}},[i("start-uploader",{attrs:{msg:t.musicTitle},on:{fileRecieve:t.onMusicFileRecieve}}),i("start-uploader",{attrs:{msg:t.scoreTitle},on:{fileRecieve:t.onScoreFileRecieve}}),i("div",{attrs:{id:"start-go-next"}},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedKey,expression:"selectedKey"}],staticClass:"uk-select uk-form-width-medium",attrs:{id:"start-key-selector"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedKey=e.target.multiple?i:i[0]}}},[i("option",[t._v("5")]),i("option",[t._v("7")]),i("option",[t._v("11")])]),i("router-link",{staticClass:"start-go-btn btn-red",attrs:{to:{name:"editor",path:"editor",params:{scoreData:t.scoreDataStr,musicUrl:t.musicUrl},query:{key:t.selectedKey}}}},[t._v(" NEXT ")])],1),i("div",{attrs:{id:"start-version"}},[t._v("ver 0.0.0 created by SKB")])],1)])},J=[],G=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"start-music-select"},on:{dragover:function(e){return e.preventDefault(),t.ondragover(e)},drop:function(e){return e.preventDefault(),t.ondrop(e)}}},[i("div",{staticClass:"uk-placeholder uk-text-center uk-margin-remove-bottom",attrs:{"uk-form-custom":""}},[i("input",{ref:"input",attrs:{type:"file"},on:{change:t.loadFile}}),i("span",{attrs:{"uk-icon":"icon: upload"}}),i("span",{staticClass:"uk-text-middle"},[t._v(" "+t._s(t.msg)+" ")]),i("span",{staticClass:"uk-link"},[t._v("参照")])])])},I=[],q=a["a"].extend({name:"StartUploader",props:{msg:String},data:function(){return{vue:this,file:null}},methods:{ondragover:function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="copy")},ondrop:function(t){if(t.dataTransfer){var e=t.dataTransfer.files[0]||null;this.file=e}else this.file=null},loadFile:function(t){if(t.target instanceof HTMLInputElement){var e=t.target.files?t.target.files[0]:null;this.file=e}else this.file=null}},watch:{file:function(t){null!==t?this.$emit("fileRecieve",t):alert("ファイルが見つかりませんでした。")}}}),H=q,V=Object(u["a"])(H,G,I,!1,null,null,null),X=V.exports,Q=a["a"].extend({name:"StartMain",components:{StartUploader:X},data:function(){return{musicTitle:"楽曲ファイルをドロップ",scoreTitle:"譜面ファイルをドロップ",selectedKey:"5",musicUrl:null,scoreDataStr:null}},methods:{onMusicFileRecieve:function(t){var e=this,i="audio.*";if(t.type.match(i)){var a=new FileReader;a.onload=function(){var i=a.result;"string"==typeof i&&(e.musicUrl=i,e.musicTitle=t.name)},a.readAsDataURL(t)}else alert("音楽ファイルではありません。")},onScoreFileRecieve:function(t){var e=this,i="(application/json|text/plain)";if(t.type.match(i)){var a=new FileReader;a.onload=function(){var i=a.result;"string"==typeof i&&(e.scoreDataStr=i,e.scoreTitle=t.name)},a.readAsText(t)}else alert("譜面ファイルではありません。")}}}),Y=Q,Z=Object(u["a"])(Y,B,J,!1,null,null,null),tt=Z.exports,et=a["a"].extend({name:"Start",components:{StartMain:tt}}),it=et,at=Object(u["a"])(it,$,W,!1,null,null,null),nt=at.exports,rt=i("8c4f");a["a"].config.productionTip=!1,a["a"].use(rt["a"]);var st=new rt["a"]({routes:[{path:"/",name:"Start",component:nt},{path:"/editor",name:"editor",component:F,props:function(t){return{loadScoreDataStr:t.params.scoreData,loadMusicUrl:t.params.musicUrl,selectedKey:t.query.key||"7"}}}]}),ot=i("8323"),ut=i.n(ot),ct=i("263c"),lt=i.n(ct);i("30b0"),i("d0e7");ut.a.use(lt.a),a["a"].config.productionTip=!1,new a["a"]({router:st,render:function(t){return t(l)}}).$mount("#app")}});
//# sourceMappingURL=app.a711f60f.js.map